!function(t){var i=t.seriesTypes,e=t.merge,l=t.extendClass,o=t.getOptions(),n=o.plotOptions,a=function(){},s=t.each,r=t.pick,h=t.Series,d=t.Color;n.treemap=e(n.scatter,{showInLegend:!1,marker:!1,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.value}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,states:{hover:{borderColor:"#A0A0A0",brightness:i.heatmap?0:.1,shadow:!1}},drillUpButton:{position:{align:"left",x:10,y:-50}}});var c={pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",dashstyle:"borderDashStyle"},pointArrayMap:["value"],axisTypes:i.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:a,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:i.heatmap&&i.heatmap.prototype.translateColors};i.treemap=l(i.scatter,e(c,{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:l(t.Point,{setState:function(i,e){t.Point.prototype.setState.call(this,i,e),"hover"===i?this.dataLabel&&this.dataLabel.attr({zIndex:1002}):this.dataLabel&&this.dataLabel.attr({zIndex:this.pointAttr[""].zIndex+1})}}),handleLayout:function(){var t,i=this,e=this.tree;this.points.length&&(e||(this.nodeMap=[],e=this.tree=this.getTree()),this.rootNode||(this.rootNode=""),this.levelMap=this.getLevels(),s(i.points,function(t){delete t.plotX,delete t.plotY}),t=this.getSeriesArea(e.val),this.nodeMap[""].values=t,this.calculateArea(e,t),this.setPointValues())},getTree:function(){var t,i,e=this,l=0,o=[],n=[],a=function(t){s(o[t],function(t){o[""].push(t)})},h=function(t,i,l,o,n,a){var d,c,p,u,v,f=[],g=[],x=0,y=n[i];return u=function(){var t=0,i=!1;0!==g.length&&s(g,function(e){p.val>e.val&&!i&&(g.splice(t,0,p),i=!0),t+=1}),i||g.push(p)},y&&(v=y.name||""),void 0!==o[t]&&s(o[t],function(i){p=h(n[i].id,i,l+1,o,n,t),x+=p.val,u(),f.push(p)}),d=r(n[i]&&n[i].value,x,0),c={id:t,i:i,children:g,childrenTotal:x,val:d,level:l,parent:a,name:v},e.nodeMap[c.id]=c,c};s(this.points,function(t){var i="";n.push(t.id),void 0!==t.parent&&(i=t.parent),void 0===o[i]&&(o[i]=[]),o[i].push(l),l+=1});for(i in o)o.hasOwnProperty(i)&&""!==i&&-1===HighchartsAdapter.inArray(i,n)&&(a(i),delete o[i]);return t=h("",-1,0,o,this.points,null)},calculateArea:function(t,i){var e,l,o,n=[],a=this,r=a.options,h=r.layoutAlgorithm,d=r.alternateStartingDirection,c=this.nodeMap[this.rootNode].level,p=0,u=r.levelIsConstant?t.level:t.level-c;t.isVisible=t.id===this.rootNode||!(!this.nodeMap[t.parent]||!this.nodeMap[t.parent].isVisible),u=u>0?u:0,this.levelMap[u+1]&&(l=this.levelMap[u+1],l.layoutAlgorithm&&a[l.layoutAlgorithm]&&(h=l.layoutAlgorithm),l.layoutStartingDirection&&(i.direction="vertical"===l.layoutStartingDirection?0:1)),n=a[h](i,t.children),s(t.children,function(l){u=r.levelIsConstant?l.level:l.level-c,o=a.points[l.i],o.level=u,e=n[p],e.val=l.childrenTotal,e.direction=i.direction,d&&(e.direction=1-e.direction),l.values=e,l.isVisible=t.isVisible,o.node=l,o.value=l.val,o.isLeaf=!0,l.children.length&&(o.isLeaf=!1,a.calculateArea(l,e)),p+=1})},setPointValues:function(){var t=this,i=t.xAxis,e=t.yAxis;t.nodeMap[""].values={x:0,y:0,width:100,height:100},s(t.points,function(l){var o,n,a,s,r=l.node,h=r.values;h.x=h.x/t.axisRatio,h.width=h.width/t.axisRatio,o=Math.round(i.translate(h.x,0,0,0,1)),n=Math.round(i.translate(h.x+h.width,0,0,0,1)),a=Math.round(e.translate(h.y,0,0,0,1)),s=Math.round(e.translate(h.y+h.height,0,0,0,1)),l.value>0&&(l.shapeType="rect",l.shapeArgs={x:Math.min(o,n),y:Math.min(a,s),width:Math.abs(n-o),height:Math.abs(s-a)},l.plotX=l.shapeArgs.x+l.shapeArgs.width/2,l.plotY=l.shapeArgs.y+l.shapeArgs.height/2)})},getSeriesArea:function(t){var i=0,e=0,l=100,o=this.axisRatio=this.xAxis.len/this.yAxis.len,n=100*o,a="vertical"===this.options.layoutStartingDirection?0:1,s={x:i,y:e,width:n,height:l,direction:a,val:t};return s},getLevels:function(){var t=[],i=this.options.levels;return i&&s(i,function(i){void 0!==i.level&&(t[i.level]=i)}),t},setColorRecursive:function(t,i){var e,l,o=this;t&&(e=o.points[t.i],l=o.levelMap[t.level],i=r(e&&e.options.color,l&&l.color,i),e&&(e.color=i),t.children.length&&s(t.children,function(t){o.setColorRecursive(t,i)}))},alg_func_group:function(t,i,e,l){this.height=t,this.width=i,this.plot=l,this.direction=e,this.startDirection=e,this.total=0,this.nW=0,this.lW=0,this.nH=0,this.lH=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(t,i){return Math.max(t/i,i/t)}},this.addElement=function(t){this.lP.total=this.elArr[this.elArr.length-1],this.total=this.total+t,0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(t)},this.reset=function(){this.nW=0,this.lW=0,this.elArr=[],this.total=0}},alg_func_calcPoints:function(t,i,e,l){var o,n,a,r,h,d=e.lW,c=e.lH,p=e.plot,u=0,v=e.elArr.length-1;i?(d=e.nW,c=e.nH):h=e.elArr[e.elArr.length-1],s(e.elArr,function(t){(i||v>u)&&(0===e.direction?(o=p.x,n=p.y,a=d,r=t/a):(o=p.x,n=p.y,r=c,a=t/r),l.push({x:o,y:n,width:a,height:r}),0===e.direction?p.y=p.y+r:p.x=p.x+a),u+=1}),e.reset(),0===e.direction?e.width=e.width-d:e.height=e.height-c,p.y=p.parent.y+(p.parent.height-e.height),p.x=p.parent.x+(p.parent.width-e.width),t&&(e.direction=1-e.direction),i||e.addElement(h)},alg_func_lowAspectRatio:function(t,i,e){var l,o=[],n=this,a={x:i.x,y:i.y,parent:i},r=i.direction,h=0,d=e.length-1,c=new this.alg_func_group(i.height,i.width,r,a);return s(e,function(e){l=i.width*i.height*(e.val/i.val),c.addElement(l),c.lP.nR>c.lP.lR&&n.alg_func_calcPoints(t,!1,c,o,a),h===d&&n.alg_func_calcPoints(t,!0,c,o,a),h+=1}),o},alg_func_fill:function(t,i,e){var l,o,n,a,r,h=[],d=i.direction,c=i.x,p=i.y,u=i.width,v=i.height;return s(e,function(e){l=i.width*i.height*(e.val/i.val),o=c,n=p,0===d?(r=v,a=l/r,u-=a,c+=a):(a=u,r=l/a,v-=r,p+=r),h.push({x:o,y:n,width:a,height:r}),t&&(d=1-d)}),h},strip:function(t,i){return this.alg_func_lowAspectRatio(!1,t,i)},squarified:function(t,i){return this.alg_func_lowAspectRatio(!0,t,i)},sliceAndDice:function(t,i){return this.alg_func_fill(!0,t,i)},stripes:function(t,i){return this.alg_func_fill(!1,t,i)},translate:function(){h.prototype.translate.call(this),this.handleLayout(),this.colorAxis?this.translateColors():this.options.colorByPoint||this.setColorRecursive(this.tree,void 0)},drawDataLabels:function(){var t,i,l,o=this,n=o.points,a=this.dataLabelsGroup;s(n,function(n){n.node.isVisible&&(i=o.levelMap[n.level],!n.isLeaf||i?(t=void 0,n.isLeaf||(t={enabled:!1}),i&&(l=i.dataLabels,l&&(t=e(t,l),o._hasPointLabels=!0)),t=e(t,n.options.dataLabels),n.dlOptions=t):delete n.dlOptions)}),this.dataLabelsGroup=this.group,h.prototype.drawDataLabels.call(this),this.dataLabelsGroup=a},alignDataLabel:i.column.prototype.alignDataLabel,drawPoints:function(){var l,o,n,a=this,h=a.points,c=a.options;s(h,function(i){i.node.isVisible&&(n=a.levelMap[i.level],l={stroke:c.borderColor,"stroke-width":c.borderWidth,dashstyle:c.borderDashStyle,r:0,fill:r(i.color,a.color)},n&&(l.stroke=n.borderColor||l.stroke,l["stroke-width"]=n.borderWidth||l["stroke-width"],l.dashstyle=n.borderDashStyle||l.dashstyle),l.stroke=i.borderColor||l.stroke,l["stroke-width"]=i.borderWidth||l["stroke-width"],l.dashstyle=i.borderDashStyle||l.dashstyle,l.zIndex=1e3-2*i.level,i.pointAttr=e(i.pointAttr),o=i.pointAttr.hover,o.zIndex=1001,o.fill=d(l.fill).brighten(c.states.hover.brightness).get(),i.isLeaf||(r(c.interactByLeaf,!c.allowDrillToNode)?(l.fill="none",delete o.fill):(l.fill=d(l.fill).setOpacity(.15).get(),o.fill=d(o.fill).setOpacity(.75).get())),i.node.level<=a.nodeMap[a.rootNode].level&&(l.fill="none",l.zIndex=0,delete o.fill),i.pointAttr[""]=t.extend(i.pointAttr[""],l),i.dataLabel&&i.dataLabel.attr({zIndex:i.pointAttr[""].zIndex+1}))}),i.column.prototype.drawPoints.call(this),s(h,function(t){t.graphic&&t.graphic.attr(t.pointAttr[""])}),c.allowDrillToNode&&a.drillTo()},drillTo:function(){var i=this,e=i.points;s(e,function(e){var l,o;e.node.isVisible&&(t.removeEvent(e,"click"),e.drillUp&&t.addEvent(e,"click",function(){i.drillUp()}),e.graphic&&e.graphic.css({cursor:"default"}),l=i.options.interactByLeaf?i.drillToByLeaf(e):i.drillToByGroup(e),l&&(o=i.nodeMap[i.rootNode].name||i.rootNode,e.graphic&&e.graphic.css({cursor:"pointer"}),t.addEvent(e,"click",function(){e.setState(""),i.drillToNode(l),i.showDrillUpButton(o)})))})},drillToByGroup:function(t){var i=this,e=!1;return 1!==t.node.level-i.nodeMap[i.rootNode].level||t.isLeaf||(e=t.id),e},drillToByLeaf:function(t){var i,e=this,l=!1;if(t.node.parent!==e.rootNode&&t.isLeaf)for(i=t.node;!l;)i=e.nodeMap[i.parent],i.parent===e.rootNode&&(l=i.id);return l},drillUp:function(){var t,i,e=null;this.rootNode&&(t=this.nodeMap[this.rootNode],e=null!==t.parent?this.nodeMap[t.parent]:this.nodeMap[""]),null!==e&&(this.drillToNode(e.id),""===e.id?this.drillUpButton=this.drillUpButton.destroy():(i=this.nodeMap[e.parent],this.showDrillUpButton(i.name||i.id)))},drillToNode:function(t){var i=this.nodeMap[t],e=i.values;this.rootNode=t,this.xAxis.setExtremes(e.x,e.x+e.width,!1),this.yAxis.setExtremes(e.y,e.y+e.height,!1),this.chart.redraw()},showDrillUpButton:function(t){var i,e,l=this,o=t||"< Back",n=l.options.drillUpButton;n.text&&(o=n.text),this.drillUpButton?this.drillUpButton.attr({text:o}).align():(i=n.theme,e=i&&i.states,this.drillUpButton=this.chart.renderer.button(o,null,null,function(){l.drillUp()},i,e&&e.hover,e&&e.select).attr({align:n.position.align,zIndex:9}).add().align(n.position,!1,n.relativeTo||"plotBox"))},buildKDTree:a,drawLegendSymbol:t.LegendSymbolMixin.drawRectangle,getExtremes:function(){h.prototype.getExtremes.call(this,this.colorValueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,h.prototype.getExtremes.call(this)},bindAxes:function(){var i={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};h.prototype.bindAxes.call(this),t.extend(this.yAxis.options,i),t.extend(this.xAxis.options,i)}}))}(Highcharts);